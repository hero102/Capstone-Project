<div class="login-wrapper">
  <div class="login-container">
    <div class="login-card">

      <!-- HEADER -->
      <div class="login-header">
        <div class="logo-circle">
          <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <h2>Employee Portal</h2>
        <p *ngIf="step === 'LOGIN' && !showForgotPassword">Sign in to access your dashboard</p>
        <p *ngIf="step === 'OTP'">Enter the OTP sent to your registered mobile/email</p>
      </div>

      <!-- BODY -->
      <div class="login-body">

        <!-- LOGIN FORM -->
        <ng-container *ngIf="step === 'LOGIN' && !showForgotPassword">
          <div class="form-group">
            <label>Email / Username</label>
            <input class="form-control" [(ngModel)]="form.usernameOrEmail" placeholder="Enter your email or username" />
          </div>

          <div class="form-group">
            <label>Password</label>
            <input type="password" class="form-control" [(ngModel)]="form.password" placeholder="Enter your password" />
          </div>

          <div class="form-group captcha-wrapper">
            <re-captcha #captchaRef (resolved)="onCaptchaResolved($event)"
              siteKey="6LcOeuErAAAAAOG2ghBKFw-UetKNdFFvbPMeFcCz"></re-captcha>
            <div class="error-message" *ngIf="error">{{ error }}</div>
          </div>

          <button class="btn-login" (click)="onSubmit()" [disabled]="loading">
            <span *ngIf="!loading">Sign In</span>
            <span *ngIf="loading">Logging in...</span>
          </button>

          <div class="login-footer">
            <a href="javascript:void(0)" (click)="showForgotPassword = true">Forgot Password?</a>
          </div>
        </ng-container>

        <!-- LOGIN OTP -->
        <ng-container *ngIf="step === 'OTP' && !showForgotPassword">
          <app-otp-verification [usernameOrEmail]="form.usernameOrEmail"></app-otp-verification>
          <div class="login-footer">
            <button class="btn-login" (click)="resendOtp()" [disabled]="loading">Resend OTP</button>
          </div>
        </ng-container>

        <!-- FORGOT PASSWORD -->
        <div *ngIf="showForgotPassword" class="forgot-password">
          <!-- STEP 1: REQUEST OTP -->
          <div *ngIf="reset.step === 'REQUEST'">
            <div class="form-group">
              <label>Email or Username</label>
              <input class="form-control" [(ngModel)]="reset.identifier" placeholder="Enter your email or username" />
            </div>
            <button class="btn-login" (click)="requestResetOtp()" [disabled]="reset.loading">
              <span *ngIf="!reset.loading">Request OTP</span>
              <span *ngIf="reset.loading">Sending...</span>
            </button>

            <div class="login-footer">
              <a href="javascript:void(0)" (click)="showForgotPassword = false">Back to Login</a>
            </div>
          </div>

          <!-- STEP 2: VERIFY OTP + NEW PASSWORD -->
          <div *ngIf="reset.step === 'OTP'">
            <h3>üîê Reset Your Password</h3>
            <p>Enter the OTP sent to your registered email and choose a new password.</p>

            <div class="form-group">
              <label>Enter OTP</label>
              <input type="text" maxlength="6" class="form-control" [(ngModel)]="reset.otp" placeholder="Enter 6-digit OTP" />
            </div>

            <div class="form-group">
              <label>New Password</label>
              <input type="password" class="form-control" [(ngModel)]="reset.newPassword" placeholder="Enter new password" />
            </div>

            <button class="btn-login" (click)="verifyAndResetPassword()" [disabled]="reset.loading">
              <span *ngIf="!reset.loading">Reset Password</span>
              <span *ngIf="reset.loading">Processing...</span>
            </button>

            <div class="login-footer">
              <a href="javascript:void(0)" (click)="reset.step = 'REQUEST'">Back</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- DECORATION -->
    <div class="login-decoration">
      <div class="deco-circle deco-1"></div>
      <div class="deco-circle deco-2"></div>
      <div class="deco-circle deco-3"></div>
    </div>
  </div>
</div>